<html>
	<head>
		<title>prog 5</title>
		<style>
		label {
			width: 60px;
			text-align: right;
			padding-right: 5px;
			display: inline-block;
		}
		input[type="number"] {
			width:50px;
			margin-right: 25px;
		}
		</style>
	</head>
	<body onload="addForm();">
		<h1>Add new input lines to HTML entry form</h1>
		<button type="button" onclick="addLine();">Add Line</button>
		<br>
		<div id="div1"></div>
		<br>
		<button type="button" onclick="displayInfo();">Display Info</button>
		<p id="p1"></p>
		
		<h1>Generate array of objects</h1>
		<button type="button" onclick="genObjectArray();">Generate and Display Array of Objects</button>
		<br>
		<p id="p2"></p>
		<div id="div2"></div>
		
		<h1>Display table containing data from array of objects</h1>
		<button type="button" onclick="genTable();">Generate and Display Table</button>
		<br>
		<div id="d3"></div>
	</body>
	<script>
		function Person(name, surname, bday, bmonth, byear, country) {
			this.name = name;
			this.surname = surname;
			this.bday = bday;
			this.bmonth = bmonth;
			this.byear = byear;
			this.country = country;
			
			//accessors
			this.getName = function(){return this.name;}
			this.getSurname = function(){return this.surname;}
			this.getBDay = function(){return this.bday;}
			this.getBMonth = function(){return this.bmonth;}
			this.getBYear = function(){return this.byear;}
			this.getCountry = function(){return this.country;}
			
			//mutators
			this.setName = function(name){this.name = name;}
			this.setSurname = function(surname){this.surname = surname;}
			this.setBDay = function(bday){this.bday = bday;}
			this.setBMonth = function(bmonth){this.bmonth = bmonth;}
			this.setBYear = function(byear){this.byear = byear;}
			this.setCountry = function(country){this.country = country;}
			
			this.info = function(){
				if (this.getCountry() = "USA"){
					return "My name is " + this.getName() + ", my surname is " + this.getSurname() + ", my i was born on " + this.getBMonth() + "/" + this.getBDay() + "/" + this.getBYear() + ", and i am from " + this.getCountry() + ".";
				}else if(this.country = "China"){
					return "My name is " + this.getName() + ", my surname is " + this.getSurname() + ", my i was born on " + this.getBMonth() + "/" + this.getBDay() + "/" + this.getBYear() + ", and i am from " + this.getCountry() + ".";
				}
			}
			
		}
		/*jane = new Person("Jane Doe","1234 Fifth Avenue");	//create new person
		document.getElementById("p1").innerHTML = jane.info();
		document.getElementById("p2").innerHTML = JSON.stringify(jane);*/

		function Table(thArr, elemId) {	//table class
		  this.thArr = thArr;
		  this.tbl = null;
		  this.makeTable = function(){
			
			// make/append new table element
			var el = document.createElement("table");
			  el.setAttribute("id","table1");
			el.setAttribute("border","1");
			  var root = 
				document.getElementById(elemId);
			  root.appendChild(el);
			// make table element the new root
			root = el;
			
			// make/append table row for headers
			var el = document.createElement("tr");
			  el.setAttribute("id","headerRow");
			  root.appendChild(el);
			// make table row the new root
			root = el;
			
			// make/append table headers
			for (i=0; i<thArr.length; i++) {
			  var thElem = 
				  document.createElement("th");
				var t = document.createTextNode(thArr[i]);
				thElem.appendChild(t);
			  root.appendChild(thElem);
			}

		  }
		}
		thArr = ["name", "street"];
		/*tbl = new Table(thArr, "d3");	//create new table
		tbl.makeTable();*/
		
		//-----DIVIDER-----//
		
			// GLOBAL VARIABLES
			var currentLine = 0;
			var inputWidth  = 10;
			var objArray    = [];
			var people	 	= [];

			// FUNCTIONS

			/* addForm()
			 * appends an entry form to an HTML element with id="div1"
			 */
			function addForm() {
				// precondition: HTML must contain <div id="div1"> element

				// create a new form element, and append to div1
				var newelement = document.createElement("form");
				newelement.setAttribute("id","form1");
				var div1 = document.getElementById("div1");
				div1.appendChild(newelement);

				// create a new fieldset element, and append to form1
				var newelement = document.createElement("fieldset");
				newelement.setAttribute("id","fieldset1");
				var form1 = document.getElementById("form1");
				form1.appendChild(newelement);

				// create a new legend element, and append to fieldset1
				var newelement = document.createElement("legend");
				var textnode = document.createTextNode("People ");
				newelement.appendChild(textnode);
				var fieldset1 = document.getElementById("fieldset1");
				fieldset1.appendChild(newelement);

				// create a new label element, and append to fieldset1
				var newelement = document.createElement("label");
				newelement.setAttribute("for","fname"+currentLine);
				var textnode = document.createTextNode("Given Name");
				newelement.appendChild(textnode);
				var fieldset1 = document.getElementById("fieldset1");
				fieldset1.appendChild(newelement);

				// create a new input element, and append to fieldset1
				var newelement = document.createElement("input");
				newelement.setAttribute("name","gname"+currentLine);
				newelement.setAttribute("id","gname"+currentLine);
				newelement.setAttribute("type","text");
				newelement.setAttribute("placeholder","Jane Doe");
				newelement.setAttribute("size",10);
				if (currentLine==0) newelement.setAttribute("autofocus","autofocus");
				var fieldset1 = document.getElementById("fieldset1");
				fieldset1.appendChild(newelement);

				// add more fields 
				
				addField("fieldset1", "sname", "Surname", "text", "Jane Doe", inputWidth);
				addField("fieldset1", "bday", "Birth Day", "number", "10", inputWidth);
				addField("fieldset1", "bmonth", "Birth Month", "number", "7", inputWidth);
				addField("fieldset1", "byear", "Birth Year", "number", "1999", inputWidth);
				addField("fieldset1", "country", "Country", "dropzone", "USA", inputWidth);
				
				// Create 
				
				// add line break 
				var newelement = document.createElement("br");
				var fieldset1 = document.getElementById("fieldset1");
				fieldset1.appendChild(newelement);

				// increment line counter
				currentLine++;
			}

			/* addLine()
			 * inserts all labels and input elements for one row of a form
			 */
			function addLine () {
				// precondition: inputWidth global variable must be set
				// precondition: call from addForm() so HTML element with id="fieldset1" exists
				
				addField("fieldset1", "gname", "Given Name", "text", "Jane Doe", inputWidth);
				addField("fieldset1", "sname", "Surname", "text", "Jane Doe", inputWidth);
				addField("fieldset1", "bday", "Birth Day", "number", "10", inputWidth);
				addField("fieldset1", "bmonth", "Birth Month", "number", "7", inputWidth);
				addField("fieldset1", "byear", "Birth Year", "number", "1999", inputWidth);
				addField("fieldset1", "country", "Country", "dropdownList", "USA", inputWidth);
				var newelement = document.createElement("br");
				var fieldset1 = document.getElementById("fieldset1");
				fieldset1.appendChild(newelement);
				currentLine++;
			}

			/* addField()
			 * inserts one label one input element into a row of a form 
			 */
			function addField(formId, namePrefix, labelText, dataType, placeholder, fieldSize) {
				// precondition: currentLine (global variable) must be set
				// precondition: objArray[] (global variable) must be declared
				// precondition: call from addLine() so HTML element with id=formID exists

				// create a new label element, and append to form (or fieldset)
				var n = document.createElement("label");
				n.setAttribute("for",namePrefix+currentLine);
				var t = document.createTextNode(labelText + " " );
				n.appendChild(t);
				var f = document.getElementById(formId);
				f.appendChild(n);
				
				if (namePrefix == "country"){
					//add select element
					var n = document.createElement("select");
					n.setAttribute("name",namePrefix+currentLine);
					n.setAttribute("id",namePrefix+currentLine);
					var f = document.getElementById(formId);
					f.appendChild(n);
					//add "China" option
					var newelement = document.createElement("option");
					newelement.setAttribute("value", "China");
					var textnode = document.createTextNode("China");
					newelement.appendChild(textnode);
					document.getElementById(namePrefix+currentLine).appendChild(newelement);
					//add "USA" option
					var newelement = document.createElement("option");
					newelement.setAttribute("value", "USA");
					var textnode = document.createTextNode("USA");
					newelement.appendChild(textnode);
					document.getElementById(namePrefix+currentLine).appendChild(newelement);
					
				}else{
					// create a new input element, and append to form
					var n = document.createElement("input");
					n.setAttribute("name",namePrefix+currentLine);
					n.setAttribute("id",namePrefix+currentLine);
					n.setAttribute("type",dataType);
					n.setAttribute("placeholder",placeholder);
					n.setAttribute("size",fieldSize);
					var f = document.getElementById(formId);
					f.appendChild(n);
				}
			}
			
			//displays a sentence about the info inputed from the above form
			function displayInfo() {	
				//clears current items to make room for new ones
				document.getElementById("p1").innerHTML = "";
				document.getElementById("p2").innerHTML = "";
				
				//go through all information and create objects for each one
				for (i = 0; i < currentLine; i++){
					var name = document.getElementById("gname" + i);
					var surname = document.getElementById("sname" + i);
					var bday = document.getElementById("bday" + i);
					var bmonth = document.getElementById("bmonth" + i);
					var byear = document.getElementById("byear" + i);
					var country = document.getElementById("country" + i);
					
					people[i] = new Person(name, surname, bday, bmonth, byear, country);	//create new person
					document.getElementById("p1").innerHTML += people[i].info();					
				}
			}
			
			/* genObjectArray()
			 * generates content for an array of objects, 
			 * where each element of the array 
			 * is an object containing the data entered in one line of the form 
			 */
			function genObjectArray() {
				// precondition: HTML must contain <div id="div2"> element
				// precondition: currentLine (global variable) must be set
				
				// generate objArray from HTML form elements
				for(i = 0; i < currentLine; i++) {
					
					/*objArray[i] = {
						'gname'     :people[i].getName(),
						'sname'     :people[i].getSurname(),
						'bday'      :people[i].getBDay(), 
						'bmonth'    :people[i].getBMonth(), 
						'byear'     :people[i].getBYear(), 
						'country'   :people[i].getCountry(),
						'countryAge':function () {
							if('China'==this.country)
								return parseInt(this.age)+1; 
							else 
								return parseInt(this.age);
							}
					};*/
					document.getElementById("p2").innerHTML = JSON.stringify(people[i]);
				}

				// display objArray
				var divContent = "<ol start='0'>";
				objArray.forEach(function(e) {
					divContent += '<li>';
					divContent += JSON.stringify(e);
					divContent += ' ... countryAge() == ' + e.countryAge();
					divContent += '</li>';
				});
				divContent += "</ol>";
				document.getElementById("d3").innerHTML = divContent;
			}
			
			//generate initial table elements
				var tab = document.createElement("table");
				tab.setAttribute("border", "1");
				greg = document.getElementById("p3");
				var tbod = document.createElement("tbody");
				tab.appendChild(tbod);
				var tr = document.createElement("tr");
				tbod.appendChild(tr);
				//table head
				var th = document.createElement("th");
				th.innerHTML = "Local Name";
				tr.appendChild(th);
				var th2 = document.createElement("th");
				th2.innerHTML = "Local DOB";
				tr.appendChild(th2);
				var th3 = document.createElement("th");
				th3.innerHTML = "Local Age";
				tr.appendChild(th3);
				var th4 = document.createElement("th");
				th4.innerHTML = "Local Zodiac";
				tr.appendChild(th4);
			
				greg.appendChild(tab);
			
			/* genTable()
			 * generates an HTML table containing localized output from 
			 */
			 function genTable(){
				
				//table data
				for(i = 0; i < currentLine; i++) {
					var trD = document.createElement("tr");
					tbod.appendChild(trD);
					var tdD = document.createElement("td");
					tdD.innerHTML = document.getElementById("gname" + i).value + " " + document.getElementById("sname" + i).value;
					trD.appendChild(tdD);
					var tdD2 = document.createElement("td");
					if (document.getElementById("country" + i).value == "USA"){
						tdD2.innerHTML = document.getElementById("bmonth" + i).value + "/" + document.getElementById("bday" + i).value + "/" + document.getElementById("byear" + i).value;
					}else if (document.getElementById("country" + i).value == "China"){
						tdD2.innerHTML = document.getElementById("byear" + i).value + "/" + document.getElementById("bmonth" + i).value + "/" + document.getElementById("bday" + i).value;
					}
					trD.appendChild(tdD2);
					var tdD3 = document.createElement("td");
					//tdD3.innerHTML = countryAge();
					trD.appendChild(tdD3);
					var tdD4 = document.createElement("td");
					if (document.getElementById("country" + i).value == "China"){
						tdD4.innerHTML = "Chinese";
					}else if (document.getElementById("country" + i).value == "USA"){
						tdD4.innerHTML = "Western";
					}
					trD.appendChild(tdD4);	
				}
			 }
		</script>
</html>
